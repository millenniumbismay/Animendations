<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Animendations</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="description" content="" />
    <link rel="icon" href="favicon.png">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/popular_animes.css') }}">
</head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    function checkLocalStorage() {
        const recommendButton = document.querySelector('#recommend-btn');
        var item = JSON.parse(localStorage.getItem("12347"));
        if (Object.keys(item).length > 3) {
            recommendButton.disabled = false;
        } else {
            recommendButton.disabled = true;
        }
    };

    $(document).ready(checkLocalStorage);
    
    $(document).ready(function () {
        $('.submit-btn').on('click', function (event) {
            console.log('here');
            event.preventDefault();
            var title = $(this).siblings('.title').val();
            var rating = $(this).siblings('.rating').val();
            const ratingInput = document.querySelector('#rating-input');
            //const rating = ratingInput.value;
            var item = JSON.parse(localStorage.getItem("12347"));
            if (item == null) {
                item = {};
            }
            console.log(rating);
            console.log(title);
            console.log(item);
            item[title] = rating;

            console.log(item);
            //var title = $('#title').val();
            //var rating = $('#rating').val();
            localStorage.setItem('12347', JSON.stringify(item));
            const recommendButton = document.querySelector('#recommend-btn');
            if (Object.keys(item).length > 3) {
                recommendButton.disabled = false;
            } else {
                recommendButton.disabled = true;
            }
        });
    });

    function getRatings() {
        var formInfo = document.forms['recommendeditems'];
        formInfo.jsonval.value = localStorage.getItem('12347');
    };
    </script>

<body>

    

    <h1> Recommendations </h1>

    <form method="GET" action="{{ url_for('search') }}">
        <input type="text" name="query" placeholder="Search...">
        <button type="submit">Search</button>
    </form>
    <form id="recommendeditems" action="/recommendations" method="POST" onClick="getRatings()">
       <button type="submit" id="recommend-btn" class="recommend-btn" enabled> Recommend me more animes! </button>
       <input type="hidden" name="jsonval" value=""/>
    </form>

    <h2>Based on your user profile</h2>
    {% for img in imglink %}
    {% set outer_loop = loop %}
    <div class="grid-container">
    
        {% for link in img %}
        {% set inner_loop = loop %}
        <div class="grid-item">
            <img src={{link}} width="200" height="200" />
            <p>{{titles[outer_loop.index-1][inner_loop.index-1]}}</p>
            <input type="hidden" class="title" id="title" name="title"
                value="{{titles[outer_loop.index-1][inner_loop.index-1]}}">

            <input type="hidden" class="title" value="{{titles[outer_loop.index-1][inner_loop.index-1]}}">
            <!--<label for="rating">Rate this movie:</label>-->
            <input type="number" class="rating" min="1" max="10">
            <button type="button" class="submit-btn">Submit</button>
        </div>

        {% endfor %}
    </div>
    {% endfor %}


    <h2>Based on content similarity</h2>

    <div class="grid-container">
    
        {% for link in imgcontent %}
        {% set inner_loop = loop %}
        <div class="grid-item">
            <img src={{link}} width="200" height="200" />
            <p>{{titlescontent[inner_loop.index-1]}}</p>
            <input type="hidden" class="title" id="title" name="title"
                value="{{titlescontent[inner_loop.index-1]}}">

            <input type="hidden" class="title" value="{{titlescontent[inner_loop.index-1]}}">
            <!--<label for="rating">Rate this movie:</label>-->
            <input type="number" class="rating" min="1" max="10">
            <button type="button" class="submit-btn">Submit</button>
        </div>

        {% endfor %}
    </div>


   


</body>

</html>